#
# For peco
alias c=peco-change-repo
peco-change-repo() {
  output1=$(ghq list -p)
  output2=$(find $HOME/Dropbox/fukajun -maxdepth 2 | grep '.git$' | sed 's/.git$//')
  select=$(echo "$output1\n$output2"  | peco)
  if [ -z "$select" ]; then
    return
  fi
  cd $select
}

alias t=peco-change-tmux
peco-change-tmux() {
  cnt=$(ps -ef | grep tmux | grep -c -v grep)
  if [ $cnt -eq 0 ]; then
    echo "No session"
    return
  fi
  if [ "$TMUX" != "" ]; then
    echo "Already in session"
    return
  fi
  session=$(tmux list-session | peco)
  if [ -z "$session" ]; then
    return
  fi
  session_id=$(echo $session | awk 'BEGIN{FS=":"}{print $1}')
  tmux attach-session -t $session_id
}

alias pb=peco-bundle-open
peco-bundle-open() {
  select=$(bundle list | sed -e 's/^ *\* *//g' | peco)
  select_gem=$(echo $select | awk 'BEGIN{FS=" "}{print $1}')
  echo $select_gem
  if [ -z "$select_gem" ]; then
    return
  fi
  echo $select_gem
  bundle open $select_gem
}

alias h=peco-cmd-history
peco-cmd-history() {
  select=$(history -n -r 1 | peco)
  if [ -z "$select" ]; then
    return
  fi
  BUFFER="$select"
  CURSOR=$#BUFFER
}
zle -N peco-cmd-history
bindkey '^O' peco-cmd-history

alias gh=peco-git-log-hash
peco-git-log-hash() {
  git_log_format='%d %an: %s %ar %h'
  select=$(git log --graph --pretty=format:"$git_log_format" | peco)
  if [ -z "$select" ]; then
    return
  fi
  BUFFER=$(echo $select | awk -F ' ' '{ print $NF }')
  CURSOR=$#BUFFER
}
zle -N peco-git-log-hash
bindkey '^x^g' peco-git-log-hash

# ggコマンド
alias gg="gg_handler"
gg_handler() {
  echo "----------------------"
  git log --oneline --stat | head -10
  echo "----------------------"
  git status;
  echo "----------------------"
}

